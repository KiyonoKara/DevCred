# openapi.yaml
openapi: 3.1.0
info:
  title: Fake Stack Overflow API
  version: 1.0.0
  description: OpenAPI 3.1 specification for the Fake Stack Overflow backend server.
servers:
  - url: /api
    description: The API server endpoint
paths:
  # --------------------
  # QUESTION CONTROLLER
  # --------------------
  /question/getQuestion:
    get:
      tags:
        - Questions
      summary: Retrieve questions filtered by order, search, and asker.
      parameters:
        - in: query
          name: order
          schema:
            $ref: '#/components/schemas/OrderType'
          required: true
          description: The order in which to sort the questions.
        - in: query
          name: search
          schema:
            type: string
            default: ''
          required: false
          allowEmptyValue: true
          allowReserved: true # removes the requirement that search parameter should be URL encoded.
          description: Search string for questions, can include tags or keywords.
        - in: query
          name: askedBy
          schema:
            type: string
          required: false
          description: Username of the user who asked the question.
      responses:
        '200':
          description: Successfully retrieved filtered list of questions.
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/PopulatedQuestion'
        '500':
          $ref: '#/components/responses/ErrorResponse'

  /question/getQuestionById/{qid}:
    get:
      tags:
        - Questions
      summary: Retrieve a single question by its ID, incrementing its view count.
      parameters:
        - in: path
          name: qid
          schema:
            type: string
            format: object-id
          required: true
          description: The unique ID of the question.
        - in: query
          name: username
          schema:
            type: string
          required: true
          description: The username of the viewer to track views.
      responses:
        '200':
          description: Successfully retrieved question details.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PopulatedQuestion'
        '400':
          $ref: '#/components/responses/ValidationError'
        '500':
          $ref: '#/components/responses/ErrorResponse'

  /question/addQuestion:
    post:
      tags:
        - Questions
      summary: Add a new question.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/NewQuestionBody'
      responses:
        '200':
          description: Question successfully added and populated.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PopulatedQuestion'
        '400':
          $ref: '#/components/responses/ValidationError'
        '500':
          $ref: '#/components/responses/ErrorResponse'

  /question/upvoteQuestion:
    post:
      tags:
        - Questions
      summary: Upvote a question.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/VoteBody'
      responses:
        '200':
          description: Vote successfully processed.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/VoteResponse'
        '400':
          $ref: '#/components/responses/ValidationError'
        '500':
          $ref: '#/components/responses/ErrorResponse'

  /question/downvoteQuestion:
    post:
      tags:
        - Questions
      summary: Downvote a question.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/VoteBody'
      responses:
        '200':
          description: Vote successfully processed.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/VoteResponse'
        '400':
          $ref: '#/components/responses/ValidationError'
        '500':
          $ref: '#/components/responses/ErrorResponse'

  /question/getCommunityQuestions/{communityId}:
    get:
      tags:
        - Questions
      summary: Retrieve questions for a specific community.
      parameters:
        - in: path
          name: communityId
          schema:
            type: string
            format: object-id
          required: true
          description: The unique ID of the community.
      responses:
        '200':
          description: Successfully retrieved list of community questions.
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/PopulatedQuestion'
        '500':
          $ref: '#/components/responses/ErrorResponse'

  /question/delete/{qid}:
    delete:
      tags:
        - Questions
      summary: Delete a question created by the requesting user.
      parameters:
        - in: path
          name: qid
          schema:
            type: string
            format: object-id
          required: true
          description: The unique ID of the question to delete.
        - in: query
          name: username
          schema:
            type: string
          required: true
          description: Username of the user attempting to delete the question.
      responses:
        '200':
          description: Question successfully deleted.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DeleteQuestionResult'
        '403':
          description: The user is not allowed to delete this question.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SimpleErrorBody'
        '404':
          description: Question not found.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SimpleErrorBody'
        '500':
          $ref: '#/components/responses/ErrorResponse'

  # --------------------
  # ANSWER CONTROLLER
  # --------------------
  /answer/addAnswer:
    post:
      tags:
        - Answers
      summary: Add a new answer to a specific question.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AddAnswerBody'
      responses:
        '200':
          description: Answer successfully added. Returns the database answer object.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DatabaseAnswer'
        '400':
          $ref: '#/components/responses/ValidationError'
        '500':
          $ref: '#/components/responses/ErrorResponse'

  /answer/delete/{aid}:
    delete:
      tags:
        - Answers
      summary: Delete an answer created by the requesting user.
      parameters:
        - in: path
          name: aid
          schema:
            type: string
            format: object-id
          required: true
          description: The unique ID of the answer to delete.
        - in: query
          name: username
          schema:
            type: string
          required: true
          description: Username of the user attempting to delete the answer.
      responses:
        '200':
          description: Answer successfully deleted.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DeleteAnswerResult'
        '403':
          description: The user is not allowed to delete this answer.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SimpleErrorBody'
        '404':
          description: Answer not found.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SimpleErrorBody'
        '500':
          $ref: '#/components/responses/ErrorResponse'

  # --------------------
  # TAG CONTROLLER
  # --------------------
  /tags/getTagsWithQuestionNumber:
    get:
      tags:
        - Tags
      summary: Retrieve a list of all tags and the number of questions associated with each.
      responses:
        '200':
          description: Successfully retrieved list of tags and counts.
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    name:
                      type: string
                    qcnt:
                      type: integer
                      minimum: 0
        '500':
          $ref: '#/components/responses/ErrorResponse'

  /tags/getTagByName/{name}:
    get:
      tags:
        - Tags
      summary: Retrieve a single tag by its name.
      parameters:
        - in: path
          name: name
          schema:
            type: string
          required: true
          description: The name of the tag.
      responses:
        '200':
          description: Successfully retrieved tag details.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DatabaseTag'
        '404':
          description: Tag not found.
        '500':
          $ref: '#/components/responses/ErrorResponse'

  # --------------------
  # COMMENT CONTROLLER
  # --------------------
  /comment/addComment:
    post:
      tags:
        - Comments
      summary: Add a new comment to a question or an answer.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AddCommentBody'
      responses:
        '200':
          description: Comment successfully added. Returns the database comment object.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DatabaseComment'
        '400':
          $ref: '#/components/responses/ValidationError'
        '500':
          $ref: '#/components/responses/ErrorResponse'

  # --------------------
  # MESSAGE CONTROLLER
  # --------------------
  /message/addMessage:
    post:
      tags:
        - Messages
      summary: Add a new global message.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AddMessageBody'
      responses:
        '200':
          description: Message successfully added. Returns the database message object.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DatabaseMessage'
        '400':
          $ref: '#/components/responses/ValidationError'
        '500':
          $ref: '#/components/responses/ErrorResponse'

  /message/getMessages:
    get:
      tags:
        - Messages
      summary: Fetch all global messages.
      responses:
        '200':
          description: Successfully retrieved global messages.
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/DatabaseMessage'
        '500':
          $ref: '#/components/responses/ErrorResponse'

  # --------------------
  # CHAT CONTROLLER
  # --------------------
  /chat/createChat:
    post:
      tags:
        - Chats
      summary: Create a new chat conversation.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateChatBody'
      responses:
        '200':
          description: Chat successfully created. Returns the populated chat object.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PopulatedChat'
        '400':
          $ref: '#/components/responses/ValidationError'
        '500':
          $ref: '#/components/responses/ErrorResponse'

  /chat/{chatId}/addMessage:
    post:
      tags:
        - Chats
      summary: Add a new message to an existing chat.
      parameters:
        - in: path
          name: chatId
          schema:
            type: string
            format: object-id
          required: true
          description: The unique ID of the chat.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/MessageBody'
      responses:
        '200':
          description: Message successfully added. Returns the updated populated chat object.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PopulatedChat'
        '400':
          $ref: '#/components/responses/ValidationError'
        '500':
          $ref: '#/components/responses/ErrorResponse'

  /chat/{chatId}:
    get:
      tags:
        - Chats
      summary: Retrieve a single chat by its ID.
      parameters:
        - in: path
          name: chatId
          schema:
            type: string
            format: object-id
          required: true
          description: The unique ID of the chat.
      responses:
        '200':
          description: Successfully retrieved chat details.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PopulatedChat'
        '500':
          $ref: '#/components/responses/ErrorResponse'
    delete:
      tags:
        - Chats
      summary: Delete a DM for a specific user. If both users delete, removes completely.
      parameters:
        - in: path
          name: chatId
          schema:
            type: string
            format: object-id
          required: true
          description: The ID of the chat to delete for the user.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                username:
                  type: string
                  description: The username of the user deleting the chat.
              required:
                - username
      responses:
        '200':
          description: DM successfully deleted for the user or completely removed if both users deleted.
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    description: Whether the deletion was successful.
                  deletedBy:
                    type: array
                    items:
                      type: string
                    description: Array of usernames who have deleted this chat.

  /chat/{chatId}/addParticipant:
    post:
      tags:
        - Chats
      summary: Add a new participant to an existing chat.
      parameters:
        - in: path
          name: chatId
          schema:
            type: string
            format: object-id
          required: true
          description: The unique ID of the chat.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AddParticipantBody'
      responses:
        '200':
          description: Participant successfully added. Returns the updated database chat object.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PopulatedChat'
        '400':
          $ref: '#/components/responses/ValidationError'
        '500':
          $ref: '#/components/responses/ErrorResponse'

  /chat/getChatsByUser/{username}:
    get:
      tags:
        - Chats
      summary: Retrieve all chats involving a specific user.
      parameters:
        - in: path
          name: username
          schema:
            type: string
          required: true
          description: The username whose chats are being retrieved.
      responses:
        '200':
          description: Successfully retrieved list of chats.
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/PopulatedChat'
        '500':
          $ref: '#/components/responses/ErrorResponse'
        '400':
          $ref: '#/components/responses/ValidationError'

  /chat/{chatId}/canDelete:
    get:
      tags:
        - Chats
      summary: Check if a DM can be completely deleted (both users have deleted).
      parameters:
        - in: path
          name: chatId
          schema:
            type: string
            format: object-id
          required: true
          description: The ID of the chat to check.
      responses:
        '200':
          description: Successfully retrieved deletion status.
          content:
            application/json:
              schema:
                type: object
                properties:
                  canDelete:
                    type: boolean
                    description: Whether the DM can be completely deleted (both users deleted).
                  deletedBy:
                    type: array
                    items:
                      type: string
                    description: Array of usernames who have deleted the chat.
                  participants:
                    type: array
                    items:
                      type: string
                    description: Array of chat participants.
        '400':
          $ref: '#/components/responses/ValidationError'
        '500':
          $ref: '#/components/responses/ErrorResponse'

  # --------------------
  # GAME CONTROLLER
  # --------------------
  /games/create:
    post:
      tags:
        - Games
      summary: Create a new game instance.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateGameBody'
      responses:
        '200':
          description: Game successfully created. Returns the game ID (string).
          content:
            application/json:
              schema:
                type: string
                description: The ID of the newly created game.
        '400':
          $ref: '#/components/responses/ValidationError'
        '500':
          $ref: '#/components/responses/ErrorResponse'

  /games/join:
    post:
      tags:
        - Games
      summary: Join an existing game.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/GameActionBody'
      responses:
        '200':
          description: Player successfully joined. Returns the updated game state.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PopulatedGame'
        '400':
          $ref: '#/components/responses/ValidationError'
        '500':
          $ref: '#/components/responses/ErrorResponse'

  /games/leave:
    post:
      tags:
        - Games
      summary: Leave an existing game.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/GameActionBody'
      responses:
        '200':
          description: Player successfully left. Returns the updated game state.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PopulatedGame'
        '400':
          $ref: '#/components/responses/ValidationError'
        '500':
          $ref: '#/components/responses/ErrorResponse'

  /games/games:
    get:
      tags:
        - Games
      summary: Fetch a list of games, optionally filtered by type and status.
      parameters:
        - in: query
          name: gameType
          schema:
            $ref: '#/components/schemas/GameType'
          required: false
          description: Filter games by type (e.g., Nim).
        - in: query
          name: status
          schema:
            $ref: '#/components/schemas/GameStatus'
          required: false
          description: Filter games by status.
      responses:
        '200':
          description: Successfully retrieved list of games.
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/PopulatedGame'
        '500':
          $ref: '#/components/responses/ErrorResponse'

  # --------------------
  # COLLECTION CONTROLLER
  # --------------------
  /collection/create:
    post:
      tags:
        - Collections
      summary: Create a new collection.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateCollectionBody'
      responses:
        '200':
          description: Collection successfully created. Returns the populated collection object.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PopulatedCollection'
        '400':
          $ref: '#/components/responses/ValidationError'
        '500':
          $ref: '#/components/responses/ErrorResponse'

  /collection/delete/{collectionId}:
    delete:
      tags:
        - Collections
      summary: Delete a collection by ID.
      parameters:
        - in: path
          name: collectionId
          schema:
            type: string
            format: object-id
          required: true
          description: The unique ID of the collection to delete.
        - in: query
          name: username
          schema:
            type: string
          required: true
          description: The username of the user performing the deletion (for authorization).
      responses:
        '200':
          description: Collection successfully deleted. Returns the deleted collection object.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PopulatedCollection'
        '400':
          $ref: '#/components/responses/ValidationError'
        '500':
          $ref: '#/components/responses/ErrorResponse'

  /collection/toggleSaveQuestion:
    patch:
      tags:
        - Collections
      summary: Add or remove a question from a collection.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ToggleSaveQuestionBody'
      responses:
        '200':
          description:
            Collection successfully updated. Returns the updated populated collection object.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PopulatedCollection'
        '400':
          $ref: '#/components/responses/ValidationError'
        '500':
          $ref: '#/components/responses/ErrorResponse'

  /collection/getCollectionsByUsername/{username}:
    get:
      tags:
        - Collections
      summary: Retrieve all collections for a specific user, filtered by privacy.
      parameters:
        - in: path
          name: username
          schema:
            type: string
          required: true
          description: The username whose collections are being viewed.
        - in: query
          name: currentUsername
          schema:
            type: string
          required: true
          description: The username of the currently logged-in user (for permission check).
      responses:
        '200':
          description: Successfully retrieved collections list.
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/PopulatedCollection'
        '400':
          $ref: '#/components/responses/ValidationError'
        '500':
          $ref: '#/components/responses/ErrorResponse'

  /collection/getCollectionById/{collectionId}:
    get:
      tags:
        - Collections
      summary: Retrieve a single collection by ID, subject to privacy checks.
      parameters:
        - in: path
          name: collectionId
          schema:
            type: string
            format: object-id
          required: true
          description: The unique ID of the collection.
        - in: query
          name: username
          schema:
            type: string
          required: true
          description: The username of the viewer (for permission check).
      responses:
        '200':
          description: Successfully retrieved collection details.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PopulatedCollection'
        '400':
          $ref: '#/components/responses/ValidationError'
        '500':
          $ref: '#/components/responses/ErrorResponse'

  # --------------------
  # COMMUNITY CONTROLLER
  # --------------------
  /community/getCommunity/{communityId}:
    get:
      tags:
        - Communities
      summary: Retrieve a community by its ID.
      parameters:
        - in: path
          name: communityId
          schema:
            type: string
            format: object-id
          required: true
          description: The unique ID of the community.
      responses:
        '200':
          description: Successfully retrieved community details.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DatabaseCommunity'
        '500':
          $ref: '#/components/responses/ErrorResponse'

  /community/getAllCommunities:
    get:
      tags:
        - Communities
      summary: Retrieve a list of all communities.
      responses:
        '200':
          description: Successfully retrieved list of communities.
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/DatabaseCommunity'
        '500':
          $ref: '#/components/responses/ErrorResponse'

  /community/userEngagement/{username}:
    get:
      tags:
        - Communities
      summary: Retrieve the communities a user engages with the most.
      parameters:
        - in: path
          name: username
          required: true
          schema:
            type: string
          description: The username whose community engagement should be retrieved.
        - in: query
          name: limit
          required: false
          schema:
            type: integer
            minimum: 1
          description: Maximum number of communities to return.
      responses:
        '200':
          description: Successfully retrieved community engagement summary.
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/CommunityEngagementSummary'
        '500':
          $ref: '#/components/responses/ErrorResponse'

  /community/toggleMembership:
    post:
      tags:
        - Communities
      summary: Join or leave a community.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ToggleMembershipBody'
      responses:
        '200':
          description: Membership status successfully updated.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DatabaseCommunity'
        '400':
          $ref: '#/components/responses/ValidationError'
        '403':
          description: Forbidden (admin trying to leave the last admin spot).
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SimpleErrorBody'
        '404':
          description: Community not found.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SimpleErrorBody'
        '500':
          $ref: '#/components/responses/ErrorResponse'

  /community/create:
    post:
      tags:
        - Communities
      summary: Create a new community.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateCommunityBody'
      responses:
        '200':
          description: Community successfully created.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/DatabaseCommunity'
        '400':
          $ref: '#/components/responses/ValidationError'
        '500':
          $ref: '#/components/responses/ErrorResponse'

  /community/delete/{communityId}:
    delete:
      tags:
        - Communities
      summary: Delete a community (requires admin privileges).
      parameters:
        - in: path
          name: communityId
          schema:
            type: string
            format: object-id
          required: true
          description: The unique ID of the community to delete.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/DeleteCommunityBody'
      responses:
        '200':
          description: Community successfully deleted.
          content:
            application/json:
              schema:
                type: object
                properties:
                  community:
                    $ref: '#/components/schemas/DatabaseCommunity'
                  message:
                    type: string
        '400':
          $ref: '#/components/responses/ValidationError'
        '403':
          description: Forbidden
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SimpleErrorBody'
        '404':
          description: Community not found.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SimpleErrorBody'
        '500':
          $ref: '#/components/responses/ErrorResponse'

  # --------------------
  # JOB FAIR CONTROLLER
  # --------------------
  /jobfair/create:
    post:
      tags:
        - Job Fairs
      summary: Create a new job fair.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateJobFairBody'
      responses:
        '201':
          description: Job fair successfully created.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/JobFair'
        '400':
          $ref: '#/components/responses/ValidationError'
        '500':
          $ref: '#/components/responses/ErrorResponse'

  /jobfair/list:
    get:
      tags:
        - Job Fairs
      summary: Retrieve all accessible job fairs.
      parameters:
        - in: query
          name: status
          schema:
            type: string
            enum: [upcoming, live, ended]
          description: Filter by job fair status
        - in: query
          name: visibility
          schema:
            type: string
            enum: [public, invite-only]
          description: Filter by job fair visibility
      responses:
        '200':
          description: Successfully retrieved job fairs.
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/JobFair'
        '500':
          $ref: '#/components/responses/ErrorResponse'

  /jobfair/{jobFairId}:
    get:
      tags:
        - Job Fairs
      summary: Retrieve a job fair by ID.
      parameters:
        - in: path
          name: jobFairId
          required: true
          schema:
            type: string
            format: object-id
          description: The ID of the job fair
      responses:
        '200':
          description: Successfully retrieved job fair.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/JobFair'
        '403':
          description: Access denied to this job fair.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SimpleErrorBody'
        '404':
          description: Job fair not found.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SimpleErrorBody'
        '500':
          $ref: '#/components/responses/ErrorResponse'
    delete:
      tags:
        - Job Fairs
      summary: Delete a job fair (host only).
      parameters:
        - in: path
          name: jobFairId
          required: true
          schema:
            type: string
            format: object-id
          description: The ID of the job fair to delete
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - hostUsername
              properties:
                hostUsername:
                  type: string
                  description: The username of the job fair host
      responses:
        '200':
          description: Job fair successfully deleted.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/JobFair'
        '401':
          description: Authentication required.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SimpleErrorBody'
        '403':
          description: Only the host can delete the job fair.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SimpleErrorBody'
        '404':
          description: Job fair not found.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SimpleErrorBody'
        '500':
          $ref: '#/components/responses/ErrorResponse'

  /jobfair/{jobFairId}/status:
    patch:
      tags:
        - Job Fairs
      summary: Update job fair status (host only).
      parameters:
        - in: path
          name: jobFairId
          required: true
          schema:
            type: string
            format: object-id
          description: The ID of the job fair
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - status
              properties:
                status:
                  type: string
                  enum: [upcoming, live, ended]
                  description: The new status for the job fair
      responses:
        '200':
          description: Job fair status successfully updated.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/JobFair'
        '401':
          description: Authentication required.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SimpleErrorBody'
        '403':
          description: Only the host can update job fair status.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SimpleErrorBody'
        '404':
          description: Job fair not found.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SimpleErrorBody'
        '500':
          $ref: '#/components/responses/ErrorResponse'

  /jobfair/{jobFairId}/join:
    post:
      tags:
        - Job Fairs
      summary: Join a job fair.
      parameters:
        - in: path
          name: jobFairId
          required: true
          schema:
            type: string
            format: object-id
          description: The ID of the job fair to join
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - username
              properties:
                username:
                  type: string
                  description: The username of the participant
      responses:
        '200':
          description: Successfully joined job fair.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/JobFair'
        '400':
          description: User is already a participant or other error.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SimpleErrorBody'
        '403':
          description: Access denied to this job fair.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SimpleErrorBody'
        '404':
          description: Job fair not found.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SimpleErrorBody'
        '500':
          $ref: '#/components/responses/ErrorResponse'

  /jobfair/{jobFairId}/leave:
    post:
      tags:
        - Job Fairs
      summary: Leave a job fair.
      parameters:
        - in: path
          name: jobFairId
          required: true
          schema:
            type: string
            format: object-id
          description: The ID of the job fair to leave
      responses:
        '200':
          description: Successfully left job fair.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/JobFair'
        '400':
          description: User is not a participant.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SimpleErrorBody'
        '401':
          description: Authentication required.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SimpleErrorBody'
        '404':
          description: Job fair not found.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SimpleErrorBody'
        '500':
          $ref: '#/components/responses/ErrorResponse'

  /jobfair/{jobFairId}/message:
    post:
      tags:
        - Job Fairs
      summary: Send a message in job fair chat.
      parameters:
        - in: path
          name: jobFairId
          required: true
          schema:
            type: string
            format: object-id
          description: The ID of the job fair
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - msg
                - msgFrom
                - msgDateTime
              properties:
                msg:
                  type: string
                  description: The message content
                msgFrom:
                  type: string
                  description: The username of the message sender
                msgDateTime:
                  type: string
                  format: date-time
                  description: The timestamp of the message
      responses:
        '200':
          description: Message successfully sent.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/JobFair'
        '403':
          description: Only participants and hosts can send messages.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SimpleErrorBody'
        '404':
          description: Job fair not found.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SimpleErrorBody'
        '500':
          $ref: '#/components/responses/ErrorResponse'

  # --------------------
  # USER METRICS CONTROLLER
  # --------------------
  /metrics/{username}:
    get:
      tags:
        - User Metrics
      summary: Get metrics for a specific user.
      parameters:
        - in: path
          name: username
          required: true
          schema:
            type: string
          description: The username to get metrics for
        - in: query
          name: populate
          schema:
            type: boolean
          description: Whether to populate referenced questions
      responses:
        '200':
          description: Successfully retrieved user metrics.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserMetrics'
        '404':
          description: User metrics not found.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SimpleErrorBody'
        '500':
          $ref: '#/components/responses/ErrorResponse'

  /metrics/update:
    post:
      tags:
        - User Metrics
      summary: Update metrics for a user.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateUserMetricsBody'
      responses:
        '200':
          description: Successfully updated user metrics.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserMetrics'
        '500':
          $ref: '#/components/responses/ErrorResponse'

  /metrics/top/{metric}:
    get:
      tags:
        - User Metrics
      summary: Get top users by a specific metric.
      parameters:
        - in: path
          name: metric
          required: true
          schema:
            type: string
            enum:
              - reputationPoints
              - totalAnswers
              - totalQuestions
              - viewsReceived
          description: The metric to rank users by
        - in: query
          name: limit
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 10
          description: Maximum number of users to return
      responses:
        '200':
          description: Successfully retrieved top users.
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/UserMetrics'
        '400':
          description: Invalid metric specified.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SimpleErrorBody'
        '500':
          $ref: '#/components/responses/ErrorResponse'
  # --------------------
  # JOB APPLICATION CONTROLLER
  # --------------------
  /jobapplication/create:
    post:
      tags:
        - Job Applications
      summary: Create a new job application
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateJobApplicationBody'
      responses:
        '201':
          description: Job application successfully created.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/JobApplication'
        '401':
          $ref: '#/components/responses/ValidationError'
        '400':
          $ref: '#/components/responses/ValidationError'
        '404':
          $ref: '#/components/responses/ContentNotFoundError'
        '500':
          $ref: '#/components/responses/ErrorResponse'

  /jobapplication/{applicationId}:
    delete:
      tags:
        - Job Applications
      summary: Deletes the application by the given application ID.
      parameters:
        - in: path
          required: true
          name: applicationId
          schema:
            type: string
          description: Id of the job application being deleted.
        - in: query
          name: username
          schema:
            type: string
          description: username of user requesting delete.
      responses:
        '200':
          description: Successfully deleted job application.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/JobApplication'
        '400':
          $ref: '#/components/responses/ValidationError'
        '401':
          $ref: '#/components/responses/ValidationError'
        '403':
          $ref: '#/components/responses/ValidationError'
        '404':
          $ref: '#/components/responses/ContentNotFoundError'
        '500':
          $ref: '#/components/responses/ErrorResponse'

  /jobapplication/{user}:
    get:
      tags:
        - Job Applications
      summary: Retrieve all applications for the given user.
      parameters:
        - in: path
          name: user
          required: true
          schema:
            type: string
          description: Username of the user to get applications for.
      responses:
        '200':
          description: Successfully retrieved job applications.
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/JobApplication'
        '401':
          $ref: '#/components/responses/ValidationError'
        '403':
          $ref: '#/components/responses/ValidationError'
        '500':
          $ref: '#/components/responses/ErrorResponse'

  /jobapplication/{jobId}/job:
    get:
      tags:
        - Job Applications
      summary: Retrieve all job applications by given jobId.
      parameters:
        - in: path
          name: jobId
          required: true
          schema:
            type: string
          description: Job Id of job to fetch applications for.
        - in: query
          name: username
          schema:
            type: string
          description: User requesting all job applications by job id.
      responses:
        '200':
          description: Successfully retrieved job applications.
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/JobApplication'
        '400':
          $ref: '#/components/responses/ValidationError'
        '401':
          $ref: '#/components/responses/ValidationError'
        '403':
          $ref: '#/components/responses/ValidationError'
        '404':
          $ref: '#/components/responses/ContentNotFoundError'
        '500':
          $ref: '#/components/responses/ErrorResponse'

  /jobapplication/{jobId}/count:
    get:
      tags:
        - Job Applications
      summary: Retrieve the count of applications for a given job.
      parameters:
        - in: path
          name: jobId
          required: true
          schema:
            type: string
          description: job ID to fetch application count for
      responses:
        '200':
          description: Successfully retrieved job application count.
          content:
            application/json:
              schema:
                type: integer
        '500':
          $ref: '#/components/responses/ErrorResponse'

  /jobapplication/{jobId}/status:
    get:
      tags:
        - Job Applications
      summary: Retrieves if a user has applied to a job or not.
      parameters:
        - in: query
          name: username
          schema:
            type: string
          description: Username of user checking if they have applied to a job
        - in: path
          name: jobId
          required: true
          schema:
            type: string
          description: ID of job user is checking application status for.
      responses:
        '200':
          description: Successfully retrieved job application status
          content:
            application/json:
              schema:
                type: object
        '400':
          $ref: '#/components/responses/ValidationError'
        '401':
          $ref: '#/components/responses/ValidationError'
        '500':
          $ref: '#/components/responses/ErrorResponse'
  # --------------------
  # JOB POSTINGS CONTROLLER
  # --------------------
  /jobposting/list:
    get:
      tags:
        - Job Postings
      summary: Retrieves filtered job postings
      parameters:
        - in: query
          name: requestor
          schema:
            type: string
          description: Username of user fetching jobs
        - in: query
          name: location
          schema:
            type: string
          description: Wanted location of jobs
        - in: query
          name: jobType
          schema:
            type: string
          description: Type of job being searched
        - in: query
          name: search
          schema:
            type: string
          description: Search keywords being used to search jobs
      responses:
        '200':
          description: Successfully retrieved job postings
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/JobPosting'
        '401':
          $ref: '#/components/responses/ValidationError'
        '500':
          $ref: '#/components/responses/ErrorResponse'

  /jobposting/{jobId}:
    get:
      tags:
        - Job Postings
      summary: Fetches job posting by specified job id
      parameters:
        - in: path
          required: true
          name: jobId
          schema:
            type: string
          description: Id of job posting being fetched.
        - in: query
          required: true
          name: requestor
          schema:
            type: string
          description: username of person fetching job.
      responses:
        '200':
          description: Successfully retrieved job posting
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/JobPosting'
        '400':
          $ref: '#/components/responses/ValidationError'
        '404':
          $ref: '#/components/responses/ContentNotFoundError'
        '500':
          $ref: '#/components/responses/ErrorResponse'
    delete:
      tags:
        - Job Postings
      summary: Deletes the job posting by the given job posting ID.
      parameters:
        - in: path
          required: true
          name: jobId
          schema:
            type: string
          description: Id of the job posting being deleted.
        - in: query
          name: requestor
          schema:
            type: string
          description: username of user requesting delete.
      responses:
        '200':
          description: Successfully deleted job posting.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/JobPosting'
        '400':
          $ref: '#/components/responses/ValidationError'
        '401':
          $ref: '#/components/responses/ValidationError'
        '404':
          $ref: '#/components/responses/ContentNotFoundError'
        '500':
          $ref: '#/components/responses/ErrorResponse'

  /jobposting/create:
    post:
      tags:
        - Job Postings
      summary: Create a new job posting
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateJobPostingBody'
      responses:
        '201':
          description: Job posting successfully created.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/JobPosting'
        '500':
          $ref: '#/components/responses/ErrorResponse'

  /jobposting/{jobId}/toggle:
    patch:
      tags:
        - Job Postings
      summary: Toggles the active status of the given posting on and off
      parameters:
        - in: path
          required: true
          name: jobId
          schema:
            type: string
          description: Id of the job posting being toggle on and off.
        - in: query
          name: requestor
          schema:
            type: string
          description: username of user requesting toggle of active status.
      responses:
        '200':
          description: Successfully changed active status of job posting.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/JobPosting'
        '400':
          $ref: '#/components/responses/ValidationError'
        '401':
          $ref: '#/components/responses/ValidationError'
        '404':
          $ref: '#/components/responses/ContentNotFoundError'
        '500':
          $ref: '#/components/responses/ErrorResponse'

  # --------------------
  # USER CONTROLLER
  # --------------------
  /user/signup:
    post:
      tags:
        - Users
      summary: Create a new user account.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UserSignupBody'
      responses:
        '200':
          description: User successfully created.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '400':
          $ref: '#/components/responses/ValidationError'
        '500':
          $ref: '#/components/responses/ErrorResponse'

  /user/login:
    post:
      tags:
        - Users
      summary: Log a user in.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UserLoginBody'
      responses:
        '200':
          description: User successfully logged in.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '400':
          $ref: '#/components/responses/ValidationError'
        '401':
          description: Authentication failed.
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
        '500':
          $ref: '#/components/responses/ErrorResponse'

  /user/resetPassword:
    patch:
      tags:
        - Users
      summary: Reset a user's password.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UserLoginBody'
      responses:
        '200':
          description: User password successfully updated.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '400':
          $ref: '#/components/responses/ValidationError'
        '500':
          $ref: '#/components/responses/ErrorResponse'

  /user/getUser/{username}:
    get:
      tags:
        - Users
      summary: Retrieve a user by username.
      parameters:
        - in: path
          required: true
          name: username
          schema:
            type: string
          description: The username of the user to retrieve.
      responses:
        '200':
          description: Successfully retrieved user details.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '500':
          $ref: '#/components/responses/ErrorResponse'

  /user/getUserActivity/{username}:
    get:
      tags:
        - Users
      summary: Retrieve activity metrics for a user.
      parameters:
        - in: path
          name: username
          schema:
            type: string
          required: true
          description: The username of the user whose activity is being requested.
        - in: query
          name: viewer
          schema:
            type: string
          required: false
          description: The username of the viewer requesting the data (used for privacy enforcement).
      responses:
        '200':
          description: Successfully retrieved user activity details.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserActivityResponse'
        '404':
          description: User not found.
        '500':
          $ref: '#/components/responses/ErrorResponse'

  /user/getUsers:
    get:
      tags:
        - Users
      summary: Retrieve a list of all users.
      responses:
        '200':
          description: Successfully retrieved list of all users.
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/User'
        '500':
          $ref: '#/components/responses/ErrorResponse'

  /user/deleteUser/{username}:
    delete:
      tags:
        - Users
      summary: Delete a user by username.
      parameters:
        - in: path
          name: username
          schema:
            type: string
          required: true
          description: The username of the user to delete.
      responses:
        '200':
          description: User successfully deleted.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '500':
          $ref: '#/components/responses/ErrorResponse'

  /user/updateBiography:
    patch:
      tags:
        - Users
      summary: Update a user's biography.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateBiographyBody'
      responses:
        '200':
          description: User biography successfully updated.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '400':
          $ref: '#/components/responses/ValidationError'
        '500':
          $ref: '#/components/responses/ErrorResponse'

  /user/updatePrivacySettings:
    patch:
      tags:
        - Users
      summary: Update a user's privacy settings (profile visibility and DM preferences).
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdatePrivacySettingsBody'
      responses:
        '200':
          description: User privacy settings successfully updated.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '400':
          $ref: '#/components/responses/ValidationError'
        '500':
          $ref: '#/components/responses/ErrorResponse'

  # --------------------
  # RESUME CONTROLLER
  # --------------------
  /resume/upload:
    post:
      tags:
        - Resumes
      summary: Upload a resume file for a user.
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                userId:
                  type: string
                  description: The username of the user uploading the resume.
                isActive:
                  type: string
                  enum: ['true', 'false', '1', '0']
                  default: 'true'
                  description: Whether to set this resume as active (sent as string from FormData).
                resume:
                  type: string
                  format: binary
                  description: The resume file (PDF only, max 8MB).
      responses:
        '200':
          description: Resume uploaded successfully.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SafeDatabaseResume'
        '400':
          description: Invalid file or no file uploaded.
        '500':
          $ref: '#/components/responses/ErrorResponse'

  /resume/user/{userId}:
    get:
      tags:
        - Resumes
      summary: Retrieve all resumes for a specific user.
      parameters:
        - in: path
          name: userId
          schema:
            type: string
          required: true
          description: The username whose resumes to retrieve.
      responses:
        '200':
          description: Successfully retrieved user's resumes.
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/SafeDatabaseResume'
        '500':
          $ref: '#/components/responses/ErrorResponse'

  /resume/download/{resumeId}:
    get:
      tags:
        - Resumes
      summary: Download a resume file by its ID.
      parameters:
        - in: path
          name: resumeId
          schema:
            type: string
            format: object-id
          required: true
          description: The ID of the resume to download.
      responses:
        '200':
          description: Resume file downloaded successfully.
          content:
            application/pdf:
              schema:
                type: string
                format: binary
        '404':
          description: Resume not found.
        '500':
          $ref: '#/components/responses/ErrorResponse'

  /resume/{resumeId}:
    delete:
      tags:
        - Resumes
      summary: Delete a resume by its ID.
      parameters:
        - in: path
          name: resumeId
          schema:
            type: string
            format: object-id
          required: true
          description: The ID of the resume to delete.
      responses:
        '200':
          description: Resume deleted successfully.
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
        '404':
          description: Resume not found.
        '500':
          $ref: '#/components/responses/ErrorResponse'

  /resume/setActive:
    put:
      tags:
        - Resumes
      summary: Set a specific resume as the active resume for a user.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - userId
                - resumeId
              properties:
                userId:
                  type: string
                  description: The username of the user.
                resumeId:
                  type: string
                  format: object-id
                  description: The ID of the resume to set as active.
      responses:
        '200':
          description: Active resume set successfully.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SafeDatabaseResume'
        '404':
          description: Resume not found.
        '500':
          $ref: '#/components/responses/ErrorResponse'

components:
  schemas:
    # --------------------
    # CORE UTIL SCHEMAS
    # --------------------
    OrderType:
      type: string
      enum:
        - newest
        - unanswered
        - active
        - mostViewed
      default: 'newest'

    VoteResponse:
      type: object
      properties:
        msg:
          type: string
        upVotes:
          type: array
          items:
            type: string
        downVotes:
          type: array
          items:
            type: string

    # --------------------
    # QUESTION SCHEMAS
    # --------------------
    VoteBody:
      type: object
      required:
        - qid
        - username
      properties:
        qid:
          type: string
          description: Unique identifier of the question.
        username:
          type: string
          description: Username of the user casting the vote.

    TagBody:
      type: object
      required:
        - name
        - description
      properties:
        name:
          type: string
          minLength: 1
          description: The name of the tag.
        description:
          type: string
          minLength: 1
          description: A brief description of the tag's purpose or usage.

    NewQuestionBody:
      type: object
      required:
        - title
        - text
        - tags
        - askedBy
        - askDateTime
      properties:
        title:
          type: string
          minLength: 1
        text:
          type: string
          minLength: 1
        tags:
          type: array
          items:
            $ref: '#/components/schemas/TagBody'
          minItems: 1
          description: Array of Tag objects, each requiring a name and description.
        askedBy:
          type: string
          minLength: 1
        askDateTime:
          type: string
          format: date-time
        community:
          type: string
          format: object-id
          nullable: true

    DatabaseQuestion:
      type: object
      description: A question document as stored in MongoDB.
      required:
        - _id
        - title
        - text
        - tags
        - askedBy
        - askDateTime
        - answers
        - views
        - upVotes
        - downVotes
        - comments
      properties:
        _id:
          type: string
          format: object-id
        title:
          type: string
        text:
          type: string
        tags:
          type: array
          items:
            type: string
            format: object-id
        askedBy:
          type: string
        askDateTime:
          type: string
          format: date-time
        answers:
          type: array
          items:
            type: string
            format: object-id
        views:
          type: array
          items:
            type: string
        upVotes:
          type: array
          items:
            type: string
        downVotes:
          type: array
          items:
            type: string
        comments:
          type: array
          items:
            type: string
            format: object-id
        community:
          type: string
          format: object-id
          nullable: true

    PopulatedQuestion:
      type: object
      description: A fully populated question object with embedded tags, answers, and comments.

    # --------------------
    # ANSWER SCHEMAS
    # --------------------
    AnswerBody:
      type: object
      required:
        - text
        - ansBy
        - ansDateTime
      properties:
        text:
          type: string
          minLength: 1
        ansBy:
          type: string
          minLength: 1
        ansDateTime:
          type: string
          format: date-time

    AddAnswerBody:
      type: object
      required:
        - qid
        - ans
      properties:
        qid:
          type: string
          format: object-id
          description: The ID of the question the answer belongs to.
        ans:
          $ref: '#/components/schemas/AnswerBody'

    DatabaseAnswer:
      type: object
      description: An answer object as stored in MongoDB.
      required:
        - _id
        - text
        - ansBy
        - ansDateTime
        - comments
      properties:
        _id:
          type: string
          format: object-id
        text:
          type: string
        ansBy:
          type: string
        ansDateTime:
          type: string
          format: date-time
        comments:
          type: array
          items:
            type: string
            format: object-id

    # --------------------
    # TAG SCHEMAS
    # --------------------
    DatabaseTag:
      type: object
      description: A tag object as stored in the database.

    # --------------------
    # COMMENT SCHEMAS
    # --------------------
    CommentBody:
      type: object
      required:
        - text
        - commentBy
        - commentDateTime
      properties:
        text:
          type: string
          minLength: 1
        commentBy:
          type: string
          minLength: 1
        commentDateTime:
          type: string
          format: date-time

    AddCommentBody:
      type: object
      required:
        - id
        - type
        - comment
      properties:
        id:
          type: string
          format: object-id
          description: The ID of the parent (question or answer).
        type:
          type: string
          enum:
            - question
            - answer
          description: The type of document the comment is attached to.
        comment:
          $ref: '#/components/schemas/CommentBody'

    DatabaseComment:
      type: object
      description: A comment object as stored in the database.

    # --------------------
    # MESSAGE SCHEMAS
    # --------------------
    MessageBody:
      type: object
      required:
        - msg
        - msgFrom
        - msgDateTime
      properties:
        msg:
          type: string
          minLength: 1
        msgFrom:
          type: string
          minLength: 1
        msgDateTime:
          type: string
          format: date-time

    AddMessageBody:
      type: object
      required:
        - messageToAdd
      properties:
        messageToAdd:
          $ref: '#/components/schemas/MessageBody'

    DatabaseMessage:
      type: object
      description: A message object as stored in the database.

    # --------------------
    # CHAT SCHEMAS
    # --------------------
    CreateChatBody:
      type: object
      required:
        - participants
        - messages
      properties:
        participants:
          type: array
          minItems: 1
          items:
            type: string
        messages:
          type: array
          items:
            $ref: '#/components/schemas/MessageBody'

    AddParticipantBody:
      type: object
      required:
        - username
      properties:
        username:
          type: string
          description: The username of the new participant.

    PopulatedChat:
      type: object
      description: A fully populated chat object with embedded messages.

    # --------------------
    # GAME SCHEMAS
    # --------------------
    GameType:
      type: string
      enum: # Based on known game types like 'Nim'
        - Nim
        - TBD_OtherGame
      description: The type of game to create.

    GameStatus:
      type: string
      enum:
        - WAITING_TO_START
        - IN_PROGRESS
        - OVER
      description: The status of the game.

    CreateGameBody:
      type: object
      required:
        - gameType
      properties:
        gameType:
          $ref: '#/components/schemas/GameType'

    GameActionBody:
      type: object
      required:
        - gameID
        - playerID
      properties:
        gameID:
          type: string
          format: object-id
        playerID:
          type: string

    PopulatedGame:
      type: object
      description: A fully populated game instance object.

    # --------------------
    # COLLECTION SCHEMAS
    # --------------------
    CreateCollectionBody:
      type: object
      required:
        - name
        - description
        - questions
        - username
      properties:
        name:
          type: string
          minLength: 1
        description:
          type: string
          minLength: 1
        questions:
          type: array
          items:
            type: string
            format: object-id
        username:
          type: string
          minLength: 1
        isPrivate:
          type: boolean
          default: false

    ToggleSaveQuestionBody:
      type: object
      required:
        - collectionId
        - questionId
        - username
      properties:
        collectionId:
          type: string
          format: object-id
        questionId:
          type: string
          format: object-id
        username:
          type: string

    PopulatedCollection:
      type: object
      description: A fully populated collection object.

    # --------------------
    # COMMUNITY SCHEMAS
    # --------------------
    CommunityVisibility:
      type: string
      enum:
        - PUBLIC
        - PRIVATE

    ToggleMembershipBody:
      type: object
      required:
        - communityId
        - username
      properties:
        communityId:
          type: string
          format: object-id
        username:
          type: string

    CreateCommunityBody:
      type: object
      required:
        - name
        - description
        - admin
      properties:
        name:
          type: string
          minLength: 1
        description:
          type: string
          minLength: 1
        admin:
          type: string
          minLength: 1
        visibility:
          $ref: '#/components/schemas/CommunityVisibility'
          default: PUBLIC
        participants:
          type: array
          items:
            type: string
          default: []

    DeleteCommunityBody:
      type: object
      required:
        - username
      properties:
        username:
          type: string
          minLength: 1
          description: The username of the admin performing the deletion.

    DatabaseCommunity:
      type: object
      description: A community object as stored in the database.

    CommunityEngagementSummary:
      type: object
      properties:
        community:
          $ref: '#/components/schemas/DatabaseCommunity'
        questionCount:
          type: integer
          minimum: 0
        answerCount:
          type: integer
          minimum: 0
        score:
          type: integer
          minimum: 0

    DeleteQuestionResult:
      type: object
      properties:
        success:
          type: boolean
          example: true
        deletedQuestionId:
          type: string
          format: object-id

    DeleteAnswerResult:
      type: object
      properties:
        success:
          type: boolean
          example: true
        deletedAnswerId:
          type: string
          format: object-id

    # --------------------
    # USER SCHEMAS
    # --------------------
    UserSignupBody:
      type: object
      required:
        - username
        - password
      properties:
        username:
          type: string
          minLength: 1
        password:
          type: string
          minLength: 1
        email:
          type: string
          format: email
          nullable: true
          description: Optional user email.
        biography:
          type: string
          default: ''
          description: Optional user biography.

    UserLoginBody:
      type: object
      required:
        - username
        - password
      properties:
        username:
          type: string
          minLength: 1
        password:
          type: string
          minLength: 1

    UpdateBiographyBody:
      type: object
      required:
        - username
        - biography
      properties:
        username:
          type: string
          minLength: 1
        biography:
          type: string

    UpdatePrivacySettingsBody:
      type: object
      required:
        - username
      properties:
        username:
          type: string
          minLength: 1
        profileVisibility:
          type: string
          enum:
            - private
            - public-metrics-only
            - public-full
          description: Controls what parts of the user's profile are visible to others
        dmEnabled:
          type: boolean
          description: Whether the user accepts direct messages

    UserActivityTagSummary:
      type: object
      properties:
        _id:
          type: string
          format: object-id
          description: Unique identifier of the associated tag.
        name:
          type: string
          description: Name of the tag.

    UserActivityQuestionSummary:
      type: object
      properties:
        id:
          type: string
          description: Unique identifier of the question.
        title:
          type: string
          description: Title of the question.
        askDateTime:
          type: string
          format: date-time
          description: When the question was asked.
        viewsCount:
          type: integer
          minimum: 0
          description: Total number of recorded views.
        answersCount:
          type: integer
          minimum: 0
          description: Number of answers this question has received.
        tags:
          type: array
          items:
            $ref: '#/components/schemas/UserActivityTagSummary'
          description: Tags attached to the question.

    UserActivityAnswerSummary:
      type: object
      properties:
        id:
          type: string
          description: Unique identifier of the answer.
        text:
          type: string
          description: Body text of the answer.
        ansDateTime:
          type: string
          format: date-time
          description: When the answer was posted.
        commentsCount:
          type: integer
          minimum: 0
          description: Number of comments left on this answer.
        question:
          type: object
          nullable: true
          properties:
            id:
              type: string
              description: Unique identifier of the related question.
            title:
              type: string
              description: Title of the related question.
            askDateTime:
              type: string
              format: date-time
            askedBy:
              type: string
              description: Author of the related question.
            viewsCount:
              type: integer
              minimum: 0
              description: Total number of views for the related question.

    UserActivityProfile:
      type: object
      properties:
        username:
          type: string
        biography:
          type: string
        dateJoined:
          type: string
          format: date-time
          nullable: true
        profileVisibility:
          type: string
          enum:
            - private
            - public-metrics-only
            - public-full

    UserActivitySummary:
      type: object
      properties:
        totalQuestions:
          type: integer
          minimum: 0
        totalAnswers:
          type: integer
          minimum: 0

    UserActivityResponse:
      type: object
      properties:
        profile:
          $ref: '#/components/schemas/UserActivityProfile'
        summary:
          $ref: '#/components/schemas/UserActivitySummary'
        visibility:
          type: string
          enum:
            - private
            - public-metrics-only
            - public-full
        canViewDetails:
          type: boolean
        isOwner:
          type: boolean
        questions:
          type: array
          items:
            $ref: '#/components/schemas/UserActivityQuestionSummary'
        answers:
          type: array
          items:
            $ref: '#/components/schemas/UserActivityAnswerSummary'

    # --------------------
    # RESUME SCHEMAS
    # --------------------
    Resume:
      type: object
      required:
        - userId
        - fileName
        - fileData
        - contentType
        - fileSize
        - uploadDate
        - isActive
      properties:
        userId:
          type: string
          description: The username of the user who owns the resume
        fileName:
          type: string
          description: The original name of the uploaded file
        fileData:
          type: string
          format: binary
          description: The binary data of the resume file
        contentType:
          type: string
          description: The MIME type of the file (e.g., 'application/pdf')
        fileSize:
          type: integer
          description: The size of the file in bytes
        uploadDate:
          type: string
          format: date-time
          description: The date when the resume was uploaded
        isActive:
          type: boolean
          description: Whether this is the user's active resume

    DatabaseResume:
      allOf:
        - $ref: '#/components/schemas/Resume'
        - type: object
          properties:
            _id:
              type: string
              format: object-id
              description: The unique identifier for the resume, generated by MongoDB

    SafeDatabaseResume:
      allOf:
        - $ref: '#/components/schemas/DatabaseResume'
        - type: object
          properties:
            fileData:
              not: {}

    # --------------------
    # JOB FAIR SCHEMAS
    # --------------------
    CreateJobFairBody:
      type: object
      required:
        - title
        - description
        - hostUsername
        - startTime
        - endTime
        - visibility
      properties:
        title:
          type: string
          minLength: 1
          description: The title of the job fair
        description:
          type: string
          minLength: 1
          description: A description of the job fair
        hostUsername:
          type: string
          minLength: 1
          description: The username of the job fair host
        startTime:
          type: string
          format: date-time
          description: When the job fair starts
        endTime:
          type: string
          format: date-time
          description: When the job fair ends
        visibility:
          type: string
          enum: [public, invite-only]
          description: Whether the job fair is public or invite-only
        invitedUsers:
          type: array
          items:
            type: string
          description: List of usernames invited to the job fair (for invite-only)

    JobFair:
      type: object
      description: A job fair object with all its properties
      properties:
        _id:
          type: string
          format: object-id
          description: The unique identifier for the job fair
        title:
          type: string
          description: The title of the job fair
        description:
          type: string
          description: A description of the job fair
        hostUsername:
          type: string
          description: The username of the job fair host
        startTime:
          type: string
          format: date-time
          description: When the job fair starts
        endTime:
          type: string
          format: date-time
          description: When the job fair ends
        status:
          type: string
          enum: [upcoming, live, ended]
          description: The current status of the job fair
        visibility:
          type: string
          enum: [public, invite-only]
          description: Whether the job fair is public or invite-only
        participants:
          type: array
          items:
            type: string
          description: List of usernames who joined the job fair
        invitedUsers:
          type: array
          items:
            type: string
          description: List of usernames invited to the job fair
        messages:
          type: array
          items:
            type: string
            format: object-id
          description: Array of message IDs for the job fair chat
        createdAt:
          type: string
          format: date-time
          description: When the job fair was created
        updatedAt:
          type: string
          format: date-time
          description: When the job fair was last updated

    User:
      type: object
      description: A user profile object.
    # --------------------
    # JOB APPLICATION SCHEMAS
    # --------------------
    CreateJobApplicationBody:
      type: object
      required:
        - username
        - jobId
      properties:
        username:
          type: string
          minLength: 1
          description: Username of the applicant making a job application
        jobId:
          type: string
          minLength: 1
          description: Id of the job the application is being created for
    JobApplication:
      type: object
      required:
        - jobPosting
        - user
        - jobStatus
        - applicationDate
      properties:
        jobPosting:
          oneOf:
            - $ref: '#/components/schemas/JobPosting'
            - type: string
              description: Object reference to the job posting associated to the application
        user:
          type: string
          description: Username of the job applicant
        jobStatus:
          type: string
          enum: ['Submitted', 'Archived', 'In Review', 'Accepted', 'Rejected']
          description: Status of the job application.
        applicationDate:
          type: object
          description: Date of application submission.
    # --------------------
    # JOB POSTINGS SCHEMAS
    # --------------------
    CreateJobPostingBody:
      type: object
      required:
        - company
        - recruiter
        - title
        - description
        - location
        - tags
        - active
      properties:
        company:
          type: string
          minLength: 1
          description: Company for which the job postings being made.
        recruiter:
          type: string
          minLength: 1
          description: Username of recruiter who is creating the job posting
        title:
          type: string
          minLength: 1
          description: Job Title
        payRange:
          type: string
          description: Pay Range of Job
        description:
          type: string
          minLength: 1
          description: Description of the job.
        location:
          type: string
          minLength: 1
          description: Location of job
        jobType:
          type: string
          enum: ['internship', 'co-op', 'full-time', 'part-time']
          description: Descriptor of job type
        tags:
          type: array
          description: Tags associated to a job posting
          items:
            type: object
        active:
          type: boolean
          description: Boolean indicating if a job posting is active or not.
        deadline:
          type: string
          format: date-time
          description: Deadline to submit applications to a given posting.

    JobPosting:
      type: object
      required:
        - company
        - recruiter
        - title
        - description
        - location
        - tags
        - active
      properties:
        company:
          type: string
          minLength: 1
          description: Company for which the job postings being made.
        recruiter:
          type: string
          minLength: 1
          description: Username of recruiter who created the job posting
        title:
          type: string
          minLength: 1
          description: Job Title
        payRange:
          type: [string, 'null']
          description: Pay Range of Job
        description:
          type: string
          minLength: 1
          description: Description of the job.
        location:
          type: string
          minLength: 1
          description: Location of job
        jobType:
          type: [string, 'null']
          enum: ['internship', 'co-op', 'full-time', 'part-time']
          description: Descriptor of job type
        tags:
          type: array
          description: Tags associated to a job posting
          items:
            type: object
        active:
          type: boolean
          minLength: 1
          description: Boolean indicating if a job posting is active or not.
        deadline:
          oneOf:
            - type: string
              format: date-time
            - type: 'null'
            - type: object
          description: Deadline to submit applications to a given posting.
    # --------------------
    # USER METRICS SCHEMAS
    # --------------------
    UserMetrics:
      type: object
      required:
        - username
        - totalQuestions
        - totalAnswers
        - totalComments
        - reputationPoints
        - questionsAnswered
        - questionsAsked
        - viewsReceived
        - createdAt
        - updatedAt
      properties:
        username:
          type: string
          description: The username these metrics belong to
        totalQuestions:
          type: integer
          description: Count of questions asked by the user
        totalAnswers:
          type: integer
          description: Count of answers provided by the user
        totalComments:
          type: integer
          description: Count of comments made by the user
        reputationPoints:
          type: integer
          description: Points earned from upvotes/downvotes
        questionsAnswered:
          type: array
          items:
            type: string
            format: object-id
          description: IDs of questions user has answered
        questionsAsked:
          type: array
          items:
            type: string
            format: object-id
          description: IDs of questions user has asked
        viewsReceived:
          type: integer
          description: Total views across all user's questions
        createdAt:
          type: string
          format: date-time
          description: When the metrics were created
        updatedAt:
          type: string
          format: date-time
          description: When the metrics were last updated

    UpdateUserMetricsBody:
      type: object
      required:
        - username
        - metrics
      properties:
        username:
          type: string
          description: The username to update metrics for
        metrics:
          type: object
          description: The metrics to update
          properties:
            totalQuestions:
              type: integer
            totalAnswers:
              type: integer
            totalComments:
              type: integer
            reputationPoints:
              type: integer
            questionsAnswered:
              type: array
              items:
                type: string
                format: object-id
            questionsAsked:
              type: array
              items:
                type: string
                format: object-id
            viewsReceived:
              type: integer

    SimpleErrorBody: # MODIFICATION: New schema for simple JSON errors like 403, 404
      type: object
      required:
        - error
      properties:
        error:
          type: string
          description: A detailed error message.
  responses:
    # --------------------
    # RESPONSE SCHEMAS
    # --------------------
    ErrorResponse:
      description: Internal Server Error
      content:
        application/json:
          schema:
            type: object
            properties:
              message:
                type: string
                description: The error message returned by the server.
    ValidationError:
      description: Bad Request / Validation Error
      content:
        application/json:
          schema:
            type: object
            properties:
              message:
                type: string
                description: The error message from express-openapi-validator.
              errors:
                type: array
                description: Detailed list of validation errors.
    ContentNotFoundError:
      description: Fetched information not found error
      content:
        application/json:
          schema:
            type: object
            properties:
              message:
                type: string
                description: Error message describing item which cannot be found
              errors:
                type: array
                description: Detailed list of item not found errors.
